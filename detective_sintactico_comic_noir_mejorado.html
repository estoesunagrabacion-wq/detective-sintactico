<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Detective Sint√°ctico ‚Äî Comic Noir Mejorado</title>
<style>
:root{
  --bg:#071020;
  --card:#0b1220;
  --accent:#ffd166;
  --muted:#9aa6b2;
  --tape:#f9d76e;
}
html,body{height:100%;margin:0;font-family:"Inter","Comic Sans MS",system-ui,sans-serif;background:linear-gradient(180deg,#03060b 0%,var(--bg) 60%);color:#e6eef6;}
.wrap{max-width:980px;margin:28px auto;padding:18px;}
header{display:flex;gap:14px;align-items:center;}
.badge{width:84px;height:84px;border-radius:12px;background:linear-gradient(135deg,#06121a,#0c2030);display:flex;align-items:center;justify-content:center;font-size:36px;border:2px solid rgba(255,209,102,0.06);box-shadow:0 8px 30px rgba(2,6,12,0.7);}
h1{margin:0;font-size:26px;letter-spacing:0.4px;}
.sub{margin:4px 0 0;color:var(--muted);font-size:13px;}

/* Card */
.card{margin-top:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:18px;box-shadow:0 12px 40px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.03);position:relative;overflow:hidden;}
.spot{position:absolute;right:-120px;top:-140px;width:420px;height:420px;background:radial-gradient(circle at 30% 20%, rgba(255,230,180,0.12), transparent 30%),radial-gradient(circle at 80% 70%, rgba(255,200,80,0.06), transparent 20%);transform:rotate(14deg);filter:blur(6px);pointer-events:none;}
.tape{position:absolute;left:18px;top:18px;padding:6px 10px;border-radius:6px;background:linear-gradient(90deg,#ffd166,#f9a826);color:#2b2b2b;font-weight:800;letter-spacing:1px;box-shadow:0 6px 16px rgba(0,0,0,0.5);transform:rotate(-8deg);}

/* City skyline background */
.skyline {
  position:absolute;left:0;right:0;bottom:0;height:160px;pointer-events:none;
  background-image: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.35)),
  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="160" viewBox="0 0 1200 160"><rect width="1200" height="160" fill="%23060b12"/><g fill="%23161e28"><rect x="10" y="40" width="60" height="120"/><rect x="90" y="56" width="44" height="104"/><rect x="150" y="20" width="120" height="140"/><rect x="280" y="80" width="40" height="80"/><rect x="340" y="32" width="80" height="128"/><rect x="440" y="70" width="60" height="90"/><rect x="520" y="20" width="160" height="140"/><rect x="700" y="52" width="44" height="108"/><rect x="760" y="30" width="90" height="130"/><rect x="880" y="48" width="60" height="112"/><rect x="960" y="10" width="120" height="150"/><rect x="1100" y="68" width="44" height="92"/></g></svg>');
  background-repeat: repeat-x; background-size: cover; opacity:0.45;
}

/* UI */
.case-header{display:flex;align-items:center;gap:18px;}
.case-title{flex:1;text-align:left;}
.case-title h2{margin:0;font-size:20px;}
.case-title p{margin:6px 0 0;color:var(--muted);font-size:13px;}
.ui{display:grid;grid-template-columns:1fr 340px;gap:18px;margin-top:18px;}
.left{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));}
.right{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.02);}

/* question and buttons */
.question{font-size:18px;margin:8px 0 18px;}
.buttons{display:flex;flex-wrap:wrap;gap:12px;}
.btn{
  background:linear-gradient(180deg,#0d2a3a,#06202b);border:2px solid rgba(255,209,102,0.06);color:var(--accent);
  padding:12px 18px;border-radius:8px;cursor:pointer;font-weight:700;box-shadow:0 6px 18px rgba(2,6,12,0.5);
  transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
  position:relative;overflow:hidden;
}
.btn:hover{transform:translateY(-4px);box-shadow:0 18px 34px rgba(2,6,12,0.6);}
.btn.secondary{background:transparent;color:var(--muted);border:1px dashed rgba(255,255,255,0.03);font-weight:600;border-radius:10px;padding:10px 14px;}

/* police-label button style (G) */
.police-label{background:linear-gradient(90deg,#f6d68a,#ffd166);color:#1b1b1b;border-radius:6px;padding:10px 14px;font-weight:900;letter-spacing:0.6px;border:2px solid rgba(0,0,0,0.18);box-shadow:0 8px 14px rgba(0,0,0,0.5);}
.police-label:active{transform:translateY(2px);}

/* result box */
.result{margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-left:4px solid var(--accent);color:#fff;}

/* file panel */
.file{display:flex;flex-direction:column;gap:10px;align-items:flex-start;}
.panel{width:100%;padding:12px;border-radius:10px;background:var(--card);box-shadow:inset 0 1px 0 rgba(255,255,255,0.02);}
.hint{font-size:13px;color:var(--muted);}

/* animations */
.fade-in{animation:fadeIn .42s ease both;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* spotlight (B) mouse-follow circle */
.screenOverlay{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;background:radial-gradient(circle at var(--mx,50%) var(--my,50%), rgba(255,240,200,0.06) 0px, rgba(255,240,200,0.02) 80px, rgba(0,0,0,0.6) 180px);transition:background .06s linear;mix-blend-mode:overlay;}

/* responsive */
@media (max-width:900px){.ui{grid-template-columns:1fr;} .right{order:-1}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge">üïµÔ∏è</div>
      <div>
        <h1>Detective Sint√°ctico ‚Äî Comic Noir</h1>
        <p class="sub">Clasifica pronombres personales como modificadores del verbo ‚Äî ahora con fondo urbano y efectos.</p>
      </div>
    </header>

    <div class="card fade-in" id="card">
      <div class="tape">CASO N¬∫ 21</div>
      <div class="spot"></div>

      <div class="case-header">
        <div class="case-title">
          <h2>El caso del pronombre misterioso</h2>
          <p>Segu√≠ las pistas y encontr√° si el <strong>se</strong> / <strong>me</strong> / <strong>te</strong> es OD, OI, reflejo, rec√≠proco, cuasirreflejo, pasiva con se o impersonal.</p>
        </div>
        <div style="text-align:right;">
          <div style="font-size:12px;color:var(--muted)">Progreso</div>
          <div id="progress" style="width:220px;height:10px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden;margin-top:8px">
            <div id="progBar" style="width:0%;height:100%;background:linear-gradient(90deg,var(--accent),#ffb84d);"></div>
          </div>
        </div>
      </div>

      <div class="ui">
        <div class="left">
          <div id="questionArea" class="fade-in">
            <div class="question" id="pregunta">Presion√° "Comenzar investigaci√≥n" para iniciar.</div>
            <div class="buttons" id="opciones">
              <button class="btn police-label" id="startBtn">üïµÔ∏è‚Äç‚ôÇÔ∏è Comenzar investigaci√≥n</button>
            </div>

            <div id="resultadoBox" style="display:none" class="result fade-in"></div>
          </div>
        </div>

        <aside class="right">
          <div class="file">
            <div class="panel">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <strong>Ficha del caso</strong>
                <small class="hint" id="hint">Sigue el √°rbol de decisi√≥n de la p√°gina 21</small>
              </div>
              <div style="margin-top:10px;color:var(--muted);font-size:13px">
                <div>‚Ä¢ Verbos: fijate en la concordancia</div>
                <div>‚Ä¢ Refuerzo: prob√° "a s√≠ mismo" o "entre ellos"</div>
                <div>‚Ä¢ Si no coincide pronombre/ sujeto ‚Üí OD o OI</div>
              </div>
            </div>

            <div class="panel">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <strong>Ejemplos r√°pidos</strong>
                <small class="hint">Tocar resultado para repetir sonido</small>
              </div>
              <div style="margin-top:10px;color:var(--muted);font-size:14px;line-height:1.5">
                <div>‚Ä¢ <em>Te vi ayer</em> ‚Üí OD/OI</div>
                <div>‚Ä¢ <em>Juan se peina</em> ‚Üí Reflejo puro</div>
                <div>‚Ä¢ <em>Ellos se saludaron</em> ‚Üí Rec√≠proco</div>
                <div>‚Ä¢ <em>Se venden coches</em> ‚Üí Pasiva con se / impersonal</div>
              </div>
            </div>

            <div style="font-size:12px;color:var(--muted);text-align:center">Versi√≥n: Comic Noir ¬∑ Offline ¬∑ Efectos adicionales</div>
          </div>
        </aside>
      </div>

      <div class="skyline"></div>
      <footer style="margin-top:16px;text-align:center;color:var(--muted);font-size:13px">Archivo escolar ¬∑ Mejorado</footer>
    </div>

    <div style="text-align:center;margin-top:12px">
      <button id="downloadZipBtn" class="btn secondary">üì¶ Descargar ZIP (opcional)</button>
    </div>
  </div>

  <div class="screenOverlay" id="screenOverlay"></div>

<script>
/* ---------------------------
   √Årbol de decisi√≥n (igual)
   --------------------------- */
const pasos = [
  { pregunta: "¬øEl pronombre coincide con el sujeto en persona y n√∫mero?",
    opciones:[{texto:"S√≠", siguiente:1},{texto:"No", resultado:"üîé Resultado: Objeto Directo u Objeto Indirecto. Ejemplo: ¬´Te vi ayer en la fiesta.¬ª"}] },
  { pregunta: "¬øAdmite refuerzos como ¬´a s√≠ mismo¬ª, ¬´entre ellos¬ª, ¬´mutuamente¬ª?",
    opciones:[{texto:"S√≠", siguiente:2},{texto:"No", siguiente:3}] },
  { pregunta: "Si admite refuerzos: ¬øla acci√≥n es mutua entre los miembros del sujeto (uno al otro / entre ellos)?",
    opciones:[{texto:"S√≠, es mutua", resultado:"ü§ù Resultado: Pronombre rec√≠proco. Ejemplo: ¬´Ellos se saludaron (uno al otro).¬ª"},{texto:"No, no es mutua", resultado:"ü™û Resultado: Pronombre reflejo puro (puede ser plural). Ejemplo: ¬´Ellos se peinan (cada uno a s√≠ mismo).¬ª"}] },
  { pregunta: "¬øEl verbo solo aparece en tercera persona (p. ej. ¬´se vende¬ª, ¬´se abri√≥¬ª)?",
    opciones:[{texto:"S√≠", siguiente:4},{texto:"No", resultado:"üòº Resultado: Pronombre cuasirreflejo. Ejemplo: ¬´Me dorm√≠ tarde.¬ª"}] },
  { pregunta: "¬øEl verbo concuerda en n√∫mero con lo que aparece despu√©s (p. ej. ¬´Se abrieron las puertas¬ª)?",
    opciones:[{texto:"S√≠", resultado:"üö™ Resultado: Pasiva con se. Ejemplo: ¬´Se abrieron las puertas.¬ª"},{texto:"No", resultado:"üåé Resultado: Se impersonal. Ejemplo: ¬´Aqu√≠ se trabaja mucho.¬ª"}] }
];

let pasoActual = 0;

/* ---------------------------
   Audio ‚Äî WebAudio extra sounds (H)
   We'll define functions for: click, win, folderOpen, camera, teletype
   --------------------------- */
const AudioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playTone(freq, time=0.12, type='sine', gain=0.06){
  const t = AudioCtx.currentTime;
  const o = AudioCtx.createOscillator();
  const g = AudioCtx.createGain();
  o.type = type; o.frequency.setValueAtTime(freq, t);
  g.gain.setValueAtTime(0.0001, t);
  g.gain.exponentialRampToValueAtTime(gain, t+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t+time);
  o.connect(g); g.connect(AudioCtx.destination); o.start(t); o.stop(t+time+0.02);
}

function clickSound(){ playTone(1000, 0.12, 'square', 0.08); }
function winSound(){ playTone(880, 0.28, 'sine', 0.12); playTone(660, 0.28, 'triangle', 0.08); }

function folderOpenSound(){
  // short rising arpeggio
  playTone(540, 0.12, 'sine', 0.06);
  setTimeout(()=> playTone(720, 0.12, 'sine', 0.06), 110);
  setTimeout(()=> playTone(960, 0.16, 'sine', 0.06), 220);
}

function cameraShutter(){
  // quick click + higher tick
  playTone(1200, 0.06, 'square', 0.08);
  setTimeout(()=> playTone(1600, 0.06, 'sine', 0.06), 60);
}

function teletypeSound(){
  // sequence of short blips
  const freqs = [700, 600, 760, 680, 720];
  freqs.forEach((f,i)=> setTimeout(()=> playTone(f, 0.06, 'square', 0.04), i*70));
}

/* ---------------------------
   DOM helpers & progress
   --------------------------- */
const preguntaEl = document.getElementById('pregunta');
const opcionesEl = document.getElementById('opciones');
const resultadoBox = document.getElementById('resultadoBox');
const progBar = document.getElementById('progBar');
const screenOverlay = document.getElementById('screenOverlay');

function actualizarProgreso(){
  const total = pasos.length;
  const pct = Math.round( (pasoActual / (total-1)) * 100 );
  progBar.style.width = pct + '%';
}

/* render paso with lighting animation (F) */
function mostrarPaso(){
  const paso = pasos[pasoActual];
  preguntaEl.textContent = paso.pregunta;
  opcionesEl.innerHTML = '';
  resultadoBox.style.display = 'none';

  paso.opciones.forEach((op, idx) => {
    const btn = document.createElement('button');
    btn.className = idx===0 ? 'btn police-label' : 'btn';
    btn.textContent = op.texto;
    btn.onclick = ()=>{
      // ensure audio context resumed on mobile/Chrome policies
      if(AudioCtx.state === 'suspended') AudioCtx.resume();
      clickSound();
      setTimeout(()=> elegirOpcion(idx), 90);
    };
    opcionesEl.appendChild(btn);
  });

  const help = document.createElement('button');
  help.className = 'btn secondary';
  help.textContent = '‚ùì Ejemplo';
  help.onclick = ()=> {
    resultadoBox.style.display = 'block';
    resultadoBox.textContent = {
      0: 'Ejemplo: "Juan se peina" ‚Üí el pronombre coincide con el sujeto ; "Te vi" ‚Üí no coincide.',
      1: 'Refuerzo: prob√° "a s√≠ mismo" o "entre ellos". Si suena natural, admite refuerzo.',
      2: 'Mutua = uno al otro. Reflejo puro = la acci√≥n recae sobre cada uno.',
      3: 'Si el verbo aparece solo en 3¬™ persona (avisos: "se vende") puede ser pasiva/impersonal.',
      4: 'Mirar si el verbo concuerda con lo que sigue: "Se abrieron las puertas" (concuerda) vs "Aqu√≠ se trabaja" (no concuerda).'
    }[pasoActual] || 'Pista general';
    // small effect + teletype sound
    teletypeSound();
  };
  opcionesEl.appendChild(help);

  // lighting pulse effect
  spotlightPulse();
  actualizarProgreso();
}

/* spotlight pulse (dynamic lighting) */
function spotlightPulse(){
  const el = screenOverlay;
  el.style.transition = 'none';
  el.style.setProperty('--mx', Math.random()*80 + '%');
  el.style.setProperty('--my', Math.random()*60 + '%');
  setTimeout(()=> el.style.transition = 'background 0.6s ease', 10);
  folderOpenSound();
}

/* elegir opci√≥n */
function elegirOpcion(idx){
  const paso = pasos[pasoActual];
  const opcion = paso.opciones[idx];

  if(opcion.resultado){
    preguntaEl.textContent = 'üìÅ Caso resuelto';
    opcionesEl.innerHTML = `<button class="btn" id="volver">üîÅ Volver a investigar</button>`;
    resultadoBox.style.display = 'block';
    resultadoBox.innerHTML = `<div style="font-size:15px">${opcion.resultado}</div><div style="margin-top:8px;font-size:13px;color:var(--muted)">Toc√° este recuadro para escuchar la fanfarria.</div>`;
    document.getElementById('volver').onclick = ()=> { pasoActual = 0; mostrarPaso(); };
    winSound();
    resultadoBox.onclick = ()=> winSound();
    progBar.style.width = '100%';
    setTimeout(()=> cameraShutter(), 140);
  } else if(opcion.siguiente !== undefined){
    pasoActual = opcion.siguiente;
    teletypeSound();
    mostrarPaso();
  }
}

/* mouse-follow spotlight (B) */
document.addEventListener('mousemove', (e)=>{
  const x = (e.clientX / window.innerWidth) * 100 + '%';
  const y = (e.clientY / window.innerHeight) * 100 + '%';
  screenOverlay.style.setProperty('--mx', x);
  screenOverlay.style.setProperty('--my', y);
});

/* Start button */
document.getElementById('startBtn').addEventListener('click', ()=>{
  if (AudioCtx.state === 'suspended') AudioCtx.resume();
  pasoActual = 0;
  mostrarPaso();
  clickSound();
  setTimeout(()=> folderOpenSound(), 120);
});

/* Download ZIP handler: ask the assistant to generate */
document.getElementById('downloadZipBtn').addEventListener('click', ()=>{
  alert('Si quer√©s, genero ahora mismo el ZIP con este HTML listo para descargar. Decime "s√≠, ZIP" y lo creo.');
});

// init UI
mostrarPaso();
</script>
</body>
</html>
